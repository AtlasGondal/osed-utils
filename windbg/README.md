# WinDbg Utilities (pykd)

Scripts intended to be executed **inside WinDbg** via the **pykd** extension. These helpers streamline common exploit-dev tasks like finding PPR gadgets, identifying bad characters, and searching memory.

## Requirements

- WinDbg (typically the Windows 10 SDK Debuggers)
- `pykd` installed and loadable in WinDbg

## How to Run

1. Start WinDbg and attach to your target process.
2. Load pykd:

```bash
.load pykd
```

3. Run a script with `!py`:

```bash
!py C:\path\to\SCRIPT.py [args...]
```

### Optional: make scripts easier to run
If you place these scripts somewhere like `C:\python37\scripts\`, you can run them by name:

```bash
!py find-ppr.py ...
```

---

## Contents

- [Find PPR](#find-ppr)
- [Find Bad Chars](#find-bad-chars)
- [Search](#search)

---

## Find PPR

Searches for `pop r32; pop r32; ret` sequences in **loaded modules** and filters results based on **bad chars** in the gadget address. Also prints an escaped little-endian address string you can paste into an exploit.

**Script:** [`find-ppr.py`](find-ppr.py)

### Usage

```bash
usage: find-ppr.py [-h] [-s] [-b BAD [BAD ...]] -m MODULES [MODULES ...]

options:
  -h, --help            show this help message and exit
  -s, --showbc          Show addresses with bad chars
  -b, --bad             space separated list of hex bytes that are already known bad (ex: -b 00 0a 0d)
  -m, --modules         module name(s) to search (ex: libspp diskpls libpal)
```

#### Examples

```bash
!py C:\path\to\find-ppr.py -m libspp libsync                # show all gadgets
!py C:\path\to\find-ppr.py -s -b 00 0A 0D -m libspp libsync # show all gadgets excluding bad characters
```

---

## Find Bad Chars

Helps with bad-character discovery in two ways:

- `--generate`: prints a byte-string pattern suitable for a badchar test buffer
- `--address`: compares bytes in memory against the expected generated bytes and prints `--` where corruption occurs

**Script:** [`find-bad-chars.py`](find-bad-chars.py)

### Usage

```bash
usage: find-bad-chars.py [-h] [-s START] [-e END] [-b BAD [BAD ...]] (-a ADDRESS | -g)

options:
  -h, --help            show this help message and exit
  -s, --start           hex byte from which to start searching in memory (default: 00)
  -e, --end             last hex byte to search for in memory (default: ff)
  -b, --bad             space separated list of hex bytes that are already known bad (ex: -b 00 0a 0d)
  -a, --address         address from which to begin character comparison
  -g, --generate        generate a byte string suitable for use in source code
```

#### Examples

```bash
!py C:\path\to\find-bad-chars.py --generate --bad 00 0a 0d                      # generate a byte pattern (excluding known bad bytes)
!py C:\path\to\find-bad-chars.py --generate --bad 1d --start 01                 # generate a byte pattern starting at `0x01`
!py C:\path\to\find-bad-chars.py --address esp+1 --bad 1d --start 01 --end 7f   # compare bytes in memory (example uses `esp+1` as the start address)
```

---

## Search

Small wrapper around WinDbg's `s` (search memory) command to avoid remembering the exact syntax.

- `byte`: raw bytes (default)
- `ascii`: ASCII string search
- `unicode`: UTF-16LE string search

**Script:** [`search.py`](search.py)

### Usage

```bash
usage: search.py [-h] [-t {byte,ascii,unicode}] pattern

positional arguments:
  pattern               what you want to search for

options:
  -h, --help            show this help message and exit
  -t, --type            data type to search for (default: byte)
```

#### Examples

```bash
!py C:\path\to\search.py -t ascii fafd          # search ASCII for `fafd`
!py C:\path\to\search.py -t ascii w00tw00t      # search ASCII for `w00tw00t`
!py C:\path\to\search.py "90 90 90 90"          # search for a byte pattern
```